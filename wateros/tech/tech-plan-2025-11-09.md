# Platform Vision
**Version:** 1.0 | **Last Updated:** 2025-11-22

**Context:** Expert developer + AI-assisted development workflow = 5-10x traditional build speed
**Timeline:** November 2025 ‚Üí September 2026 (10 months)
**Philosophy:** Ship fast, iterate based on real usage, build for 154 trucks not 10,000

---

## Project Structure: 2 Git Repositories

### Repository 1: `water-os-android` (Android Monorepo)
**One Android Studio project containing three Gradle modules:**

- **`driver-app/`** ‚Üí Builds Driver.apk for Google Play Store
  - Driver-specific screens: depot finder, earnings, delivery workflow

- **`customer-app/`** ‚Üí Builds Customer.apk for Google Play Store
  - Customer-specific screens: order creation, tracking, payment

- **`shared/`** ‚Üí Library module (not an APK)
  - Code used by BOTH apps: auth, API client, data models, Supabase, Paystack, maps, design system
  - 40-50% of total code is shared to eliminate duplication

**Why monorepo:** Both apps import `implementation project(':shared')` so changes to shared code automatically update both apps. One Android Studio window, single source of truth, no code duplication.

### Repository 2: `water-os-platform` (Next.js Monorepo)
**One Next.js project containing:**

- **Backend API** (`/app/api/*`)
  - REST endpoints for mobile apps
  - Order matching, payments, notifications, location verification

- **Web Admin Dashboard** (`/app/(admin)/*`)
  - Operations command center for you and your team
  - Driver management, order queue, analytics, compliance, quality assurance

- **Shared Business Logic** (`/lib/*`)
  - Database queries, payment processing, order creation, notifications

- **Optional: Depot Status Form** (`/app/depot/*`)
  - Simple web form for depot owners to update water availability
  - Only if needed based on January 2026 depot research

**Why monorepo:** API and admin dashboard share same database client, business logic, and types. Deploy together to Vercel, zero CORS issues, single source of truth.

**Note on Depot Platform:** Depending on January 2026 depot research findings, depot functionality will either:
- Stay in `water-os-platform` as simple web forms/dashboard (most likely)
- Become 3rd repository if depots need native mobile app or complex operational software (see decision criteria in Part 11)

---

## Executive Summary

**What needs to exist on September 1, 2026:**

1. **Android Driver App** - Full-featured operational tool for 10+ drivers
2. **Android Customer App** - Consumer-facing ordering system for residential + commercial
3. **Web Admin Dashboard** - Operations command center for managing entire marketplace
4. **Backend Platform** - Supabase + Next.js API handling all business logic
5. **Payment Integration** - Paystack processing for Mobile Money transactions
6. **SMS/Notifications** - Automated communication system
7. **Location Intelligence** - Manual verification system + GPS correction tools
8. **Analytics Dashboard** - Real-time operational visibility
9. **Compliance Tracking** - Driver/depot permit management
10. **Quality Assurance Tools** - Water testing workflow + documentation

**Total Build Time Estimate:** 6-7 months of focused development (Nov 2025 ‚Üí May 2026)
**Buffer:** 3 months for testing, iteration, pilot (Jun-Aug 2026)
**Launch:** September 1, 2026

---

## Part 1: Core Platform Components

### 1.1 Android Driver App

**Purpose:** Operational command center for tanker drivers

#### Must-Have Features for Launch

**Authentication & Onboarding:**
- Phone number + OTP login via Supabase Auth
- Driver profile setup (name, truck details, license photos)
- Permit upload (commercial license, WRC permit, vehicle registration)
- Bank account linking for payouts (Mobile Money number + bank details)
- Training video walkthrough (embedded in app)

**Core Workflow:**
- **Dashboard:**
  - Today's earnings (live counter)
  - Pending orders (count + urgent flags)
  - Available orders (commercial pool)
  - Quick actions: Go Online/Offline, View Depot Map

- **Depot Finder (THE KILLER FEATURE):**
  - Real-time map showing all partner depots
  - Status indicators: ‚úÖ Water Available | üü° Low Stock | ‚ö†Ô∏è Queue (30+ min) | ‚ùå Dry
  - Distance from current location + estimated fuel cost
  - Tap depot ‚Üí See details: Current queue, last updated time, prices, contact
  - **Fuel Cost Calculator:** "Depot A: 5km, ‚Çµ15 fuel" vs "Depot B: 45km, ‚Çµ120 fuel"
  - Driver can report status updates (crowd-sourced validation)

- **Order Management:**
  - **My Customers Tab:** List of driver's imported customers (5% commission)
    - Search/filter by name, location, order history
    - Quick reorder for repeat customers
    - Manual order creation (driver enters details)
  - **Available Jobs Tab:** Platform commercial orders (20% commission)
    - Filtering: By location, delivery time, volume, price
    - "Accept Order" ‚Üí Lock-in (30-min acceptance window)
    - "Skip" ‚Üí Return to pool
  - **Active Deliveries Tab:** In-progress orders with navigation
    - Customer details, delivery address, special instructions
    - "Start Trip" ‚Üí GPS tracking begins
    - "Arrived at Depot" ‚Üí Photo verification of source
    - "Water Loaded" ‚Üí Timestamp + volume confirmation
    - "En Route to Customer" ‚Üí Live tracking active
    - "Arrived" ‚Üí Customer signature + photo
    - "Complete" ‚Üí Payment processing triggered

- **Navigation Integration:**
  - One-tap "Navigate" button ‚Üí Opens Google Maps with destination
  - In-app display of corrected GPS coordinates (from manual verification database)
  - Driver can flag incorrect pins ‚Üí Operations team reviews

- **Customer Management:**
  - Import existing customers (name, phone, address, tank size, notes)
  - Customer history: past orders, payment status, preferences
  - Quick call/SMS to customer
  - Add notes: "Tank location behind house", "Gate code: 1234"

- **Earnings & Payments:**
  - Daily earnings breakdown: Orders completed, commission earned, tips
  - Weekly/monthly summaries with charts
  - Payout history: Mobile Money transfers completed
  - "Request Payout" button (24-hour processing for balances >‚Çµ100)

- **Quality Assurance:**
  - Upload photo at depot (proves water source)
  - Checkbox: "I certify this water is from [Depot Name]"
  - Random testing notifications: "Your delivery selected for quality test"

- **Support & Help:**
  - In-app chat with operations team (async messaging)
  - Emergency hotline (click-to-call)
  - FAQ section
  - Video tutorials

**Technical Stack:**
- **Framework:** Kotlin + Jetpack Compose (modern Android dev)
- **Maps:** Google Maps SDK (already familiar)
- **Auth:** Supabase Auth + Phone OTP
- **Real-time:** Supabase Realtime subscriptions (depot status, order updates)
- **Local Storage:** Room Database (offline-first for poor connectivity areas)
- **Camera:** CameraX (depot photos, delivery confirmations)
- **Notifications:** Firebase Cloud Messaging

**Build Time Estimate:** 8-10 weeks (2.5 months)
- Week 1-2: Auth, onboarding, profile setup
- Week 3-4: Depot finder + map integration + fuel calculator
- Week 5-6: Order management (my customers + available jobs)
- Week 7-8: Active delivery workflow + GPS tracking
- Week 9-10: Earnings, payments, quality assurance, polish

---

### 1.2 Android Customer App

**Purpose:** Consumer-facing ordering system for residential + commercial purchasers

#### Must-Have Features for Launch

**Authentication & Onboarding:**
- Phone number + OTP login
- Customer profile: Name, delivery addresses (home, business), payment methods
- Account type selection: Residential vs Commercial (different pricing/features)

**Core Workflow:**
- **Home Screen:**
  - Big "Order Water" button
  - Recent orders (reorder with one tap)
  - Estimated delivery time based on current driver availability
  - Promotions banner (e.g., "15% off for new customers - 3 months remaining")

- **Order Creation:**
  - **Step 1 - Location:**
    - Select from saved addresses OR enter new address
    - GPS pin placement with manual correction (drag pin to exact tank location)
    - Add delivery notes: "Behind main house", "Call when arriving"
  - **Step 2 - Volume:**
    - Select tank size: 1,000L | 2,000L | 3,000L | 5,000L | Custom
    - Show estimated fill percentage based on tank size
  - **Step 3 - Timing:**
    - ASAP (default) OR Schedule for later (date + time picker)
  - **Step 4 - Review:**
    - Delivery details summary
    - Price breakdown: Water + Delivery + Platform Fee + Subsidy (first 3 months) = Total
    - Payment method: Mobile Money (MTN/Vodafone) OR Cash on Delivery
  - **Step 5 - Confirm:**
    - "Place Order" ‚Üí Driver matching begins

- **Order Tracking:**
  - Order status updates: Searching for Driver ‚Üí Driver Assigned ‚Üí En Route to Depot ‚Üí Water Loaded ‚Üí En Route to You ‚Üí Arrived ‚Üí Completed
  - Live map showing driver's current location (when en route)
  - Driver details: Name, photo, truck number, phone (click-to-call)
  - ETA countdown
  - Push notifications for each status change

- **Payment:**
  - **Mobile Money:** Integrated with Paystack (MTN MoMo, Vodafone Cash)
    - Save payment methods for quick checkout
    - Payment triggered on order completion (after delivery confirmation)
  - **Cash on Delivery:** Driver collects cash, confirms in app
  - Payment history with receipts

- **Order History:**
  - List of all past orders with details
  - Reorder button (copies previous order details)
  - Rate & review driver (5-star + text feedback)
  - Download receipt (PDF)

- **Quality Assurance:**
  - See water source: "Fetched from [Depot Name] - WRC Permit #12345"
  - Quality certificate: "Last tested: [Date] by SGS Ghana"
  - Report issue: "Water quality concern" ‚Üí Ops team investigates

- **Account Management:**
  - Saved addresses (add/edit/delete)
  - Payment methods
  - Order preferences (default volume, preferred delivery times)
  - Referral code (invite friends, get ‚Çµ20 credit)

**Commercial Customer Features (Additional):**
- **Recurring Orders:**
  - Set up weekly/bi-weekly deliveries (e.g., "Every Monday, 9am, 2,000L")
  - Pause/resume subscriptions
- **Invoice Management:**
  - Monthly invoices for accounting
  - Bulk order history export (CSV)
- **Multiple Delivery Locations:**
  - Manage multiple sites (for multi-location businesses)

**Technical Stack:**
- **Framework:** Kotlin + Jetpack Compose
- **Maps:** Google Maps SDK
- **Payments:** Paystack Android SDK
- **Auth:** Supabase Auth
- **Real-time:** Supabase Realtime (order tracking)
- **Notifications:** Firebase Cloud Messaging

**Build Time Estimate:** 6-8 weeks (2 months)
- Week 1-2: Auth, profile, address management
- Week 3-4: Order creation flow + payment integration
- Week 5-6: Order tracking + live map + notifications
- Week 7-8: Order history, ratings, quality assurance, polish

---

### 1.3 Web Admin Dashboard

**Purpose:** Operations command center for YOU (founder) and your operations team to manage the entire marketplace

**Who uses this:** You, Operations Manager, Sales Team, Driver Support Manager, Depot Relationship Manager

**NOT for:** Depot owners (they get simple status update form or WhatsApp/SMS-based updates)

#### Must-Have Features for Launch

**Authentication & Roles:**
- Role-based access: Admin (Founder), Operations Manager, Sales Team, Driver Support, Depot Manager
- Secure login with 2FA

**Dashboard Home:**
- **Real-Time Metrics (Live Updating):**
  - Active drivers online now
  - Orders in progress (map view + list)
  - Today's GMV, commission revenue, completed deliveries
  - Week-to-date / Month-to-date comparisons
  - Critical alerts: Drivers offline >2 hours, orders pending >30 min, depot issues

- **Quick Actions:**
  - Manual order dispatch (for phone orders)
  - Broadcast message to all drivers
  - Mark depot as dry/available
  - Approve driver applications

**Driver Management:**
- **Driver Directory:**
  - List of all drivers (active, pending, suspended)
  - Search/filter by name, truck number, status, location
  - Click driver ‚Üí Full profile
    - Personal details, truck info, permits (view uploaded documents)
    - Performance metrics: Total deliveries, average rating, earnings, on-time %
    - Order history
    - Compliance status: ‚úÖ All permits valid | ‚ö†Ô∏è Permit expiring soon | ‚ùå Expired
    - Actions: Suspend, Approve, Message, Call

- **Driver Applications:**
  - Queue of pending driver applications
  - Review uploaded documents (license, permits, truck registration)
  - Approve/Reject with notes
  - Send training materials via SMS/email

- **Driver Performance Dashboard:**
  - Leaderboard: Top earners, highest ratings, most deliveries
  - Retention tracking: Drivers active this week vs last 4 weeks
  - Churn alerts: Drivers who haven't logged in for 7+ days

**Order Management:**
- **Live Orders Map:**
  - Real-time map showing all active orders
  - Color-coded pins: üîµ Pending Assignment | üü° Driver En Route to Depot | üü¢ En Route to Customer | ‚ö™ Completed
  - Click pin ‚Üí Order details + actions

- **Order Queue:**
  - List of all orders (pending, active, completed)
  - Filters: Status, driver, customer, date range, commercial vs residential
  - Click order ‚Üí Full details:
    - Customer info, delivery address, volume, price
    - Assigned driver (if any)
    - Timeline: Order created ‚Üí Driver assigned ‚Üí Pickup ‚Üí Delivery ‚Üí Completed
    - Photos: Depot source photo, delivery confirmation photo
    - Payment status
    - Actions: Reassign driver, cancel, refund, contact customer/driver

- **Manual Dispatch:**
  - For phone orders or emergency situations
  - Create order manually, select driver, override pricing if needed
  - Useful for VIP customers or testing

**Customer Management:**
- **Customer Directory:**
  - List of all customers (residential, commercial)
  - Search/filter by name, phone, location, account type
  - Click customer ‚Üí Profile:
    - Contact details, saved addresses
    - Order history (frequency, volume, spend)
    - Payment history
    - Notes/flags: VIP, payment issues, quality complaints
    - Actions: Call, SMS, create order, add note

- **Commercial Clients Dashboard:**
  - Dedicated view for B2B customers
  - Contract status, monthly volume commitments
  - Recurring order management
  - Invoice generation

**Depot Management:**
- **Depot Directory:**
  - List of all partner depots
  - Map view showing depot locations
  - Click depot ‚Üí Details:
    - Contact info, address, WRC permit, contract terms
    - Current status: Available / Low Stock / Dry / Queue
    - Real-time data: Last updated time, reported by whom
    - Historical data: Average queue time, reliability score
    - Actions: Update status, contact owner, suspend partnership

- **Depot Status Updates:**
  - **Primary (V1):** Manual updates by Depot Relationship Manager via phone/WhatsApp calls
  - **Secondary (V1):** SMS/WhatsApp bot (depot owners text keywords like "Available")
  - **Optional (V1):** Simple web form for self-service status updates (if depot owners request it)
  - **Future (Month 13+):** IoT sensors for automated water level monitoring
  - Crowd-sourced updates from drivers (displayed with verification)

- **Depot Performance:**
  - Reliability metrics: Uptime %, average queue time
  - Volume supplied over time
  - Driver satisfaction ratings

**Note:** Depot owners do NOT get a full dashboard in V1. They communicate status to you via phone/WhatsApp, and YOU update the admin dashboard. A simple web form MAY be built if depot research shows they want self-service (1-2 days of work).

**Quality Assurance:**
- **Testing Workflow:**
  - Queue of deliveries flagged for random testing
  - Assign tester, schedule pickup
  - Record test results: Pass/Fail + details
  - Upload lab report (PDF)
  - Actions if fail: Suspend driver, investigate depot, contact customer

- **Compliance Tracking:**
  - Dashboard showing all drivers' permit expiry dates
  - Alerts: Expiring in 30 days, expired
  - Depot WRC permit tracking
  - Monthly compliance report generation

**Financial Management:**
- **Revenue Dashboard:**
  - Daily/weekly/monthly GMV charts
  - Commission breakdown: 5% existing customers, 20% new commercial
  - Payment processing fees
  - Net revenue after costs
  - Export to CSV for accounting

- **Payout Management:**
  - Queue of pending driver payouts
  - Approve/process batch payouts
  - Payout history
  - Reconciliation tools

- **Subsidy Tracking (Months 1-3):**
  - Total subsidies disbursed
  - Per-customer subsidy amounts
  - Budget burn rate vs plan

**Analytics & Reporting:**
- **Business Intelligence:**
  - Key metrics: GMV, orders, drivers, customers, market share
  - Growth charts: Week-over-week, month-over-month
  - Cohort analysis: Customer retention, driver retention
  - Geographic heatmaps: Where are orders concentrated?
  - Time-of-day patterns: Peak ordering hours

- **Operational Reports:**
  - Daily operations summary (automated email)
  - Weekly performance report (GMV, drivers, retention)
  - Monthly board report (for investors)
  - Export data to Google Sheets for deeper analysis

**Communication Tools:**
- **Broadcast Messaging:**
  - Send SMS/push notification to all drivers or selected groups
  - Templates: "Depot X now has water", "Reminder: Upload permits by Friday"

- **Customer Support Inbox:**
  - In-app messages from customers/drivers
  - Assign to team member
  - Canned responses for common questions
  - Close with notes

**Settings & Configuration:**
- **Platform Settings:**
  - Pricing rules: Base price, distance multipliers, surge pricing (future)
  - Commission rates (verify 5% vs 20%)
  - Subsidy parameters (amount, duration)
  - Service area boundaries (geofencing)

- **User Management:**
  - Admin user accounts
  - Role assignments
  - Activity logs (audit trail)

**Technical Stack:**
- **Framework:** Next.js 14+ (React) with TypeScript
- **UI:** Tailwind CSS + shadcn/ui components
- **Maps:** Google Maps JavaScript API
- **Charts:** Recharts or Chart.js
- **Auth:** Supabase Auth
- **Real-time:** Supabase Realtime subscriptions
- **Hosting:** Vercel

**Build Time Estimate:** 10-12 weeks (3 months)
- Week 1-2: Auth, dashboard home, metrics
- Week 3-4: Driver management (directory, applications, performance)
- Week 5-6: Order management (live map, queue, dispatch)
- Week 7-8: Customer + depot management
- Week 9-10: Quality assurance + financial management
- Week 11-12: Analytics, communication tools, settings, polish

---

### 1.4 Backend Platform

**Purpose:** Core business logic, database, and API layer powering all apps

#### Architecture

**Database (Supabase Postgres):**

**Core Tables:**

```sql
-- Users (unified table for all user types)
users (
  id uuid PRIMARY KEY,
  phone_number text UNIQUE,
  email text,
  user_type enum ('driver', 'customer', 'admin'),
  created_at timestamp,
  updated_at timestamp
)

-- Driver Profiles
driver_profiles (
  id uuid PRIMARY KEY,
  user_id uuid REFERENCES users(id),
  full_name text,
  truck_number text,
  truck_capacity_liters int,
  commercial_license_url text,
  wrc_permit_url text,
  wrc_permit_expiry date,
  vehicle_registration_url text,
  bank_account_number text,
  mobile_money_number text,
  mobile_money_network enum ('mtn', 'vodafone', 'airteltigo'),
  approval_status enum ('pending', 'approved', 'rejected', 'suspended'),
  approved_at timestamp,
  approved_by uuid REFERENCES users(id),
  rating_avg decimal(3,2),
  total_deliveries int DEFAULT 0,
  total_earnings_pesewas bigint DEFAULT 0,
  created_at timestamp
)

-- Customer Profiles
customer_profiles (
  id uuid PRIMARY KEY,
  user_id uuid REFERENCES users(id),
  full_name text,
  customer_type enum ('residential', 'commercial'),
  business_name text, -- for commercial
  created_at timestamp
)

-- Saved Addresses
addresses (
  id uuid PRIMARY KEY,
  customer_id uuid REFERENCES customer_profiles(id),
  label text, -- "Home", "Office", "Factory"
  address_text text,
  lat decimal(10,8),
  lng decimal(11,8),
  manually_verified boolean DEFAULT false,
  verified_lat decimal(10,8), -- corrected coords
  verified_lng decimal(11,8),
  delivery_notes text,
  is_default boolean DEFAULT false,
  created_at timestamp
)

-- Depots
depots (
  id uuid PRIMARY KEY,
  name text,
  owner_name text,
  owner_phone text,
  address text,
  lat decimal(10,8),
  lng decimal(11,8),
  wrc_permit_number text,
  wrc_permit_expiry date,
  wrc_permit_url text,
  contract_terms text,
  current_status enum ('available', 'low_stock', 'queue', 'dry', 'closed'),
  status_updated_at timestamp,
  status_updated_by uuid REFERENCES users(id),
  partnership_start_date date,
  active boolean DEFAULT true,
  created_at timestamp
)

-- Depot Status Updates (History)
depot_status_updates (
  id uuid PRIMARY KEY,
  depot_id uuid REFERENCES depots(id),
  status enum ('available', 'low_stock', 'queue', 'dry', 'closed'),
  reported_by_user_id uuid REFERENCES users(id),
  reported_by_type enum ('driver', 'depot_owner', 'admin'),
  notes text,
  queue_time_minutes int,
  created_at timestamp
)

-- Orders
orders (
  id uuid PRIMARY KEY,
  order_number text UNIQUE, -- e.g., "WOS-20260901-0001"
  customer_id uuid REFERENCES customer_profiles(id),
  driver_id uuid REFERENCES driver_profiles(id),

  -- Order details
  delivery_address_id uuid REFERENCES addresses(id),
  volume_liters int,
  delivery_notes text,
  scheduled_for timestamp, -- null if ASAP

  -- Pricing (stored in pesewas)
  base_price_pesewas bigint,
  delivery_fee_pesewas bigint,
  platform_fee_pesewas bigint,
  subsidy_pesewas bigint, -- negative value
  total_price_pesewas bigint,

  -- Commission
  commission_rate decimal(5,2), -- 5.00 or 20.00
  commission_pesewas bigint,

  -- Source tracking
  customer_source enum ('existing_driver_customer', 'platform_commercial', 'platform_residential'),

  -- Status tracking
  status enum ('pending_driver', 'driver_assigned', 'driver_en_route_to_depot',
               'water_loaded', 'driver_en_route_to_customer', 'arrived',
               'completed', 'cancelled'),

  -- Timestamps
  created_at timestamp,
  driver_assigned_at timestamp,
  depot_arrived_at timestamp,
  water_loaded_at timestamp,
  customer_arrived_at timestamp,
  completed_at timestamp,
  cancelled_at timestamp,
  cancellation_reason text,

  -- Quality assurance
  depot_id uuid REFERENCES depots(id),
  depot_photo_url text,
  delivery_photo_url text,
  customer_signature_url text,
  selected_for_testing boolean DEFAULT false,

  -- Payment
  payment_method enum ('mobile_money', 'cash'),
  payment_status enum ('pending', 'completed', 'failed', 'refunded'),
  payment_provider_reference text,
  paid_at timestamp,

  -- Ratings
  customer_rating int, -- 1-5
  customer_review text,
  driver_rating int, -- 1-5 (driver rates customer)

  updated_at timestamp
)

-- Order Events (Audit Trail)
order_events (
  id uuid PRIMARY KEY,
  order_id uuid REFERENCES orders(id),
  event_type text, -- 'status_changed', 'payment_processed', 'photo_uploaded', etc.
  old_value text,
  new_value text,
  metadata jsonb, -- flexible field for additional data
  created_by uuid REFERENCES users(id),
  created_at timestamp
)

-- Payments & Payouts
driver_payouts (
  id uuid PRIMARY KEY,
  driver_id uuid REFERENCES driver_profiles(id),
  period_start date,
  period_end date,
  total_earnings_pesewas bigint,
  payout_amount_pesewas bigint, -- after any deductions
  payout_method enum ('mobile_money', 'bank_transfer'),
  payout_status enum ('pending', 'processing', 'completed', 'failed'),
  processed_at timestamp,
  processed_by uuid REFERENCES users(id),
  mobile_money_reference text,
  created_at timestamp
)

-- Quality Testing
water_quality_tests (
  id uuid PRIMARY KEY,
  order_id uuid REFERENCES orders(id),
  driver_id uuid REFERENCES driver_profiles(id),
  depot_id uuid REFERENCES depots(id),
  test_date date,
  tester_name text,
  sample_collected_at timestamp,
  lab_name text, -- "SGS Ghana"
  test_result enum ('pass', 'fail', 'pending'),
  test_details jsonb, -- pH, turbidity, bacteria, etc.
  lab_report_url text,
  actions_taken text,
  created_at timestamp
)

-- Notifications
notifications (
  id uuid PRIMARY KEY,
  user_id uuid REFERENCES users(id),
  notification_type enum ('order_update', 'payment', 'quality_alert', 'system'),
  title text,
  body text,
  data jsonb, -- additional payload (order_id, etc.)
  read boolean DEFAULT false,
  sent_via enum ('push', 'sms', 'email'),
  sent_at timestamp,
  created_at timestamp
)

-- Platform Settings
settings (
  id uuid PRIMARY KEY,
  key text UNIQUE, -- 'base_price_per_liter', 'commission_rate_existing', etc.
  value text,
  data_type enum ('number', 'boolean', 'string', 'json'),
  description text,
  updated_at timestamp,
  updated_by uuid REFERENCES users(id)
)

-- Analytics Events (Simple Event Logging)
events (
  id uuid PRIMARY KEY,
  event_type text, -- 'order_created', 'driver_logged_in', 'depot_status_updated'
  user_id uuid REFERENCES users(id),
  metadata jsonb, -- all relevant data
  created_at timestamp
)
```

**Key Indexes:**
- orders(customer_id, status, created_at)
- orders(driver_id, status, created_at)
- orders(status, created_at)
- depot_status_updates(depot_id, created_at DESC)
- events(event_type, created_at)

**Business Logic (Next.js API Routes):**

**Critical APIs:**

1. **Order Matching Algorithm:**
   - `POST /api/orders/create` ‚Üí Create order, trigger matching
   - `POST /api/orders/match` ‚Üí Find optimal driver based on:
     - Driver proximity to customer
     - Driver proximity to depot
     - Driver's current workload (active orders)
     - Driver rating
     - Preferred customers (for existing relationships)
   - Returns ranked list of drivers, assigns top match

2. **Payment Processing:**
   - `POST /api/payments/initiate` ‚Üí Start Paystack payment flow
   - `POST /api/payments/webhook` ‚Üí Handle Paystack webhook (payment success/failure)
   - `POST /api/payments/payout` ‚Üí Process driver payout via Mobile Money

3. **Real-Time Updates:**
   - Use Supabase Realtime for live updates:
     - Order status changes
     - Driver location updates (throttled to every 10 seconds)
     - Depot status changes
   - No custom WebSocket infrastructure needed (Supabase handles it)

4. **Location Services:**
   - `POST /api/locations/verify` ‚Üí Admin manually verifies/corrects GPS coordinates
   - `GET /api/locations/nearby-depots` ‚Üí Return depots near driver's current location
   - `POST /api/locations/calculate-fuel-cost` ‚Üí Estimate fuel cost between two points

5. **Analytics Queries:**
   - `GET /api/analytics/dashboard` ‚Üí Return all dashboard metrics
   - `GET /api/analytics/driver-performance` ‚Üí Driver leaderboard data
   - `GET /api/reports/daily-operations` ‚Üí Generate daily report

6. **Compliance:**
   - `GET /api/compliance/expiring-permits` ‚Üí Drivers/depots with permits expiring soon
   - `POST /api/compliance/flag-expired` ‚Üí Auto-suspend drivers with expired permits (cron job)

**Cron Jobs (via Supabase pg_cron or Vercel Cron):**
- Daily: Check for expired permits, suspend drivers/depots
- Daily: Generate and email daily operations report
- Weekly: Generate driver payouts
- Monthly: Generate invoices for commercial clients

**Technical Stack:**
- **Database:** Supabase Postgres
- **Auth:** Supabase Auth (phone OTP)
- **Real-time:** Supabase Realtime
- **Storage:** Supabase Storage (photos, documents)
- **API:** Next.js 14+ API Routes (TypeScript)
- **Payments:** Paystack API
- **SMS:** Twilio or AfricasTalking
- **Hosting:** Vercel (auto-scales, zero DevOps)

**Build Time Estimate:** 6-8 weeks (2 months)
- Week 1-2: Database schema, migrations, seed data
- Week 3-4: Core APIs (order creation, matching, status updates)
- Week 5-6: Payment integration, real-time subscriptions
- Week 7-8: Analytics queries, compliance automation, cron jobs

---

### 1.5 Payment Integration

**Purpose:** Seamless Mobile Money payments via Paystack

#### Features

**Customer-Side:**
- MTN Mobile Money integration
- Vodafone Cash integration
- Save payment methods for quick checkout
- Payment triggered after delivery confirmation
- Instant payment receipts via SMS/email

**Driver-Side:**
- Daily/weekly payout summaries
- "Request Payout" button (24-hour processing)
- Mobile Money payouts to driver's registered number
- Payout history with transaction IDs

**Admin-Side:**
- Batch payout processing
- Payment reconciliation dashboard
- Failed payment retry mechanism
- Refund processing

**Technical Implementation:**
- Paystack Android SDK for mobile apps
- Paystack API for backend processing
- Webhook handling for payment confirmations
- Store payment references in database for reconciliation

**Build Time Estimate:** 1-2 weeks
- Week 1: Paystack integration (customer payments)
- Week 2: Driver payouts + admin reconciliation

---

### 1.6 SMS & Notifications

**Purpose:** Keep all parties informed in real-time

#### Notification Types

**Push Notifications (via Firebase Cloud Messaging):**
- Order status updates (for customers)
- New order alerts (for drivers)
- Quality testing selections (for drivers)
- Permit expiry reminders (for drivers)
- Payout confirmations (for drivers)

**SMS Notifications (via Twilio or AfricasTalking):**
- OTP codes for login
- Order confirmations (customers)
- Payment receipts (customers)
- Critical alerts (if push fails)

**Email Notifications:**
- Daily operations reports (admin)
- Monthly invoices (commercial customers)
- Quality test results (admin)

**In-App Inbox:**
- System messages
- Support responses
- Announcements

**Technical Implementation:**
- Firebase Cloud Messaging for push
- Twilio/AfricasTalking for SMS
- SendGrid/Mailgun for email
- Supabase notifications table for in-app inbox

**Build Time Estimate:** 1-2 weeks
- Week 1: FCM setup, basic push notifications
- Week 2: SMS integration, email templates, in-app inbox

---

### 1.7 Location Intelligence System

**Purpose:** Build the most accurate water delivery location database in Accra

#### V1 Manual Verification System

**Process:**
1. **Initial Data Collection:**
   - When customer places first order, they drop pin on map
   - Google Maps provides initial coordinates

2. **Driver Correction on Delivery:**
   - After first delivery, driver prompted: "Was this pin accurate?"
   - If No ‚Üí Driver corrects pin to exact tank location
   - App stores both original and corrected coordinates

3. **Admin Verification:**
   - Operations Manager reviews corrections in admin dashboard
   - Approve ‚Üí Corrected coordinates become verified location
   - Flag patterns: If multiple drivers correct same location, auto-verify

4. **Subsequent Orders:**
   - Verified locations used for all future deliveries
   - "Verified Location ‚úì" badge shown to drivers
   - Continuous refinement: Driver can still flag if incorrect

**Database Fields:**
```sql
addresses (
  original_lat, original_lng,      -- Google Maps initial
  verified_lat, verified_lng,      -- Driver/admin corrected
  manually_verified boolean,       -- Admin approved
  verification_count int,          -- # of drivers who confirmed
  successful_deliveries int        -- Confidence metric
)
```

**Admin Tools:**
- Map view showing all addresses (color-coded: verified, pending, unverified)
- Click address ‚Üí See original vs corrected pins
- Approve/reject corrections
- Batch verification for addresses with multiple confirmations

**Build Time Estimate:** 1-2 weeks
- Week 1: Driver correction workflow in app
- Week 2: Admin verification dashboard

**Future Enhancement (Month 13+):**
- Version history (track all corrections over time)
- ML confidence scoring
- Photo verification (driver uploads photo of tank/gate)

---

### 1.8 Analytics Dashboard

**Purpose:** Real-time operational visibility for data-driven decisions

#### Key Metrics (All Real-Time)

**Business Health:**
- Today/Week/Month GMV
- Orders completed (count + chart)
- Average order value
- New customers acquired
- Customer retention rate
- Market share estimate (based on 20M liters/day GAMA demand)

**Driver Metrics:**
- Drivers online now
- Total active drivers (logged in last 7 days)
- Driver retention (active this week vs last 4 weeks)
- Average earnings per driver
- Deliveries per driver per day
- Driver satisfaction (avg rating from customers)

**Operational Efficiency:**
- Average time from order creation to driver assignment
- Average delivery time (order creation to completion)
- Order completion rate (completed vs cancelled)
- Depot uptime percentage
- Failed delivery rate

**Financial:**
- Commission earned (5% vs 20% breakdown)
- Payment processing fees
- Subsidies disbursed
- Net revenue
- Cash on hand projection

**Quality:**
- Water quality test results (pass rate)
- Customer complaints
- Driver compliance rate (permits valid)

**Geographic:**
- Heatmap showing order density
- Most active neighborhoods
- Underserved areas

**Charts:**
- Line charts: GMV over time, orders over time
- Bar charts: Deliveries by day of week, orders by hour of day
- Pie charts: Order sources (existing vs new commercial), payment methods

**Export:**
- All data exportable to CSV
- Auto-sync to Google Sheets for deeper analysis (optional)

**Technical Implementation:**
- Pre-calculated metrics (updated every minute via cron)
- SQL queries optimized with indexes
- Recharts for visualizations
- Real-time updates via Supabase Realtime

**Build Time Estimate:** 2 weeks
- Week 1: Core metrics calculation, database queries
- Week 2: Dashboard UI, charts, real-time updates

---

### 1.9 Compliance Tracking System

**Purpose:** Ensure all drivers and depots maintain valid permits

#### Features

**Driver Compliance:**
- Commercial driving license (expiry date tracking)
- WRC permit (expiry date tracking)
- Vehicle registration (expiry date tracking)
- Document upload and verification during onboarding
- Photo verification (admin reviews uploaded docs)

**Depot Compliance:**
- WRC permit tracking (expiry dates)
- Partnership agreement status
- Quality assurance compliance (random testing results)

**Automated Alerts:**
- Email/SMS to driver: "Your WRC permit expires in 30 days. Please renew."
- Admin dashboard: Red flag for expired permits
- Auto-suspend drivers with expired critical permits (e.g., WRC permit)

**Admin Tools:**
- Compliance dashboard: All drivers with permit status
- Filter: Expiring soon (30 days), expired
- Bulk actions: Send renewal reminder to all expiring soon
- Compliance report generation (monthly)

**Build Time Estimate:** 1 week
- Days 1-3: Document upload and storage
- Days 4-5: Expiry tracking and alerts
- Days 6-7: Admin compliance dashboard

---

### 1.10 Quality Assurance Workflow

**Purpose:** Systematically verify water quality and build trust

#### Features

**Random Selection:**
- 5% of deliveries randomly flagged for testing
- Driver receives in-app notification: "This delivery selected for quality test"
- Driver must follow special protocol (explained below)

**Testing Protocol:**
- Driver delivers water as normal
- After delivery, driver drives to designated sample collection point
- Quality assurance team collects 1L sample
- Sample labeled with order ID, driver ID, depot ID
- Sample sent to lab (SGS Ghana)

**Lab Testing:**
- Tests: pH, turbidity, bacterial contamination, chemical contaminants
- Results: Pass/Fail + detailed report
- Turnaround: 2-3 days

**Results Management:**
- Admin uploads lab report (PDF) to system
- If PASS: Driver gets "Quality Verified ‚úì" badge, customer notified
- If FAIL:
  - Immediate investigation triggered
  - Driver temporarily suspended pending investigation
  - Depot flagged for review
  - Customer contacted and offered refund/free delivery
  - Root cause analysis: Was it depot source issue or tanker contamination?

**Customer-Facing:**
- In customer app, show: "Water source: [Depot Name] - Last tested: [Date] - Result: ‚úÖ Pass"
- Download lab report (PDF)

**Admin Dashboard:**
- Queue of deliveries selected for testing
- Assign sample collection
- Upload lab results
- Historical test results (pass rate by depot, by driver)
- Generate quality assurance reports

**Build Time Estimate:** 1 week
- Days 1-3: Random selection algorithm, driver notification
- Days 4-5: Admin test management workflow
- Days 6-7: Results upload, customer-facing quality display

---

## Part 2: Build Timeline & Phasing

### Phase 1: Foundation (Weeks 1-4) - November 2025

**Goal:** Set up core infrastructure and database

**Tasks:**
- Supabase project setup
- Database schema design and migration
- Next.js project setup
- Android project setup (both apps)
- Git repository structure
- Development environment configuration
- Design system setup (colors, typography, components)

**Deliverable:** Empty projects with working auth

**Build Time:** 1-2 weeks (mostly boilerplate, but important to get right)

---

### Phase 2: Backend Core (Weeks 5-10) - December 2025

**Goal:** Build all core backend APIs and business logic

**Tasks:**
- User authentication (phone OTP)
- Database CRUD operations
- Order creation and matching algorithm
- Real-time subscriptions setup
- Payment integration (Paystack)
- SMS integration (Twilio/AfricasTalking)
- File storage (Supabase Storage)
- Basic admin API routes

**Deliverable:** Fully functional backend API, testable via Postman

**Build Time:** 6 weeks

---

### Phase 3: Driver App (Weeks 11-18) - January-February 2026

**Goal:** Build production-ready driver app

**Tasks:**
- Authentication and onboarding
- Depot finder + map + fuel calculator
- Order management (my customers + available jobs)
- Active delivery workflow
- Earnings and payout UI
- Quality assurance workflow
- Testing on physical Android devices
- Bug fixes and polish

**Deliverable:** Driver app ready for beta testing

**Build Time:** 8 weeks

---

### Phase 4: Customer App (Weeks 19-24) - March 2026

**Goal:** Build production-ready customer app

**Tasks:**
- Authentication and onboarding
- Order creation flow
- Payment integration (Paystack Android SDK)
- Order tracking and live map
- Order history and receipts
- Quality assurance display
- Testing on physical devices
- Bug fixes and polish

**Deliverable:** Customer app ready for beta testing

**Build Time:** 6 weeks

---

### Phase 5: Admin Dashboard (Weeks 25-32) - April-May 2026

**Goal:** Build full-featured admin dashboard

**Tasks:**
- Dashboard home with real-time metrics
- Driver management (directory, applications, performance)
- Order management (live map, queue, dispatch)
- Customer and depot management
- Quality assurance workflow
- Financial management
- Analytics and reporting
- Settings and configuration
- Testing and polish

**Deliverable:** Admin dashboard production-ready

**Build Time:** 8 weeks

---

### Phase 6: Supporting Systems (Weeks 33-36) - May-June 2026

**Goal:** Complete all supporting features

**Tasks:**
- Location verification system
- Compliance tracking
- Quality assurance workflow (end-to-end)
- Analytics dashboard enhancements
- Notification system refinements
- Admin tools polish
- Performance optimization
- Security hardening

**Deliverable:** All systems integrated and working together

**Build Time:** 4 weeks

---

### Phase 7: Testing & Iteration (Weeks 37-42) - June-July 2026

**Goal:** Beta testing with real users, fix bugs, iterate based on feedback

**Tasks:**
- Closed beta with 3-5 drivers (Week 37-38)
- Fix critical bugs from driver feedback
- Closed beta with 10-15 customers (Week 39-40)
- Fix critical bugs from customer feedback
- Operations manager training on admin dashboard
- Load testing and performance optimization
- Final security audit
- Prepare for production deployment

**Deliverable:** Battle-tested, production-ready system

**Build Time:** 6 weeks

---

### Phase 8: Launch Prep (Weeks 43-45) - August 2026

**Goal:** Final preparations for September 1 launch

**Tasks:**
- Production deployment to Vercel (backend + admin)
- Google Play Store submission (driver + customer apps)
- Final QA testing on production environment
- Create user documentation (driver onboarding guide, customer FAQ)
- Prepare launch marketing materials
- Train operations team on all systems
- Dry run: Simulate full order flow end-to-end
- Set up monitoring and alerting

**Deliverable:** Everything live and ready for launch

**Build Time:** 3 weeks

---

### September 1, 2026: LAUNCH üöÄ

---

## Part 3: Technical Complexity Assessment

### What's Easy (Because of Modern Tools)

**Auth:** Supabase Auth handles phone OTP, user management, security ‚Üí 2 days
**Database:** Postgres is mature, Supabase provides excellent DX ‚Üí 1 week
**Real-time:** Supabase Realtime eliminates WebSocket complexity ‚Üí 2 days
**Payments:** Paystack SDK is well-documented ‚Üí 3-4 days
**Maps:** Google Maps SDK is mature ‚Üí 2-3 days
**Push Notifications:** Firebase Cloud Messaging is standard ‚Üí 2 days
**Hosting:** Vercel auto-scales, zero DevOps ‚Üí 1 day
**File Storage:** Supabase Storage handles uploads ‚Üí 2 days

### What's Medium Complexity

**Order Matching Algorithm:** Not trivial, but solvable ‚Üí 1 week
**Location Verification System:** Manual process, needs good UX ‚Üí 1-2 weeks
**Analytics Queries:** SQL optimization required ‚Üí 1-2 weeks
**Payment Reconciliation:** Accounting logic, edge cases ‚Üí 1 week
**Quality Assurance Workflow:** Multi-step process with many actors ‚Üí 1-2 weeks

### What's Hard (And Why)

**GPS Accuracy in Equatorial Regions:**
- 200m+ inaccuracy is real problem
- Mitigation: Manual verification system (already planned)
- Not a blocker, just requires discipline

**Depot Data Collection:**
- Real-time depot status depends on manual updates OR IoT sensors
- V1: Manual updates via WhatsApp/SMS + driver crowd-sourcing
- Not a technical problem, but an operational one

**Driver Behavior Change:**
- Getting drivers to use app instead of phone calls
- Mitigated by: Clear value prop (depot finder saves fuel), concierge onboarding
- Not a technical problem, but a change management one

**Payment Edge Cases:**
- Failed Mobile Money transfers
- Disputed deliveries
- Refunds and chargebacks
- Mitigation: Good error handling, admin tools for manual intervention
- 1 week to build robust error handling

---

## Part 4: Risk Mitigation Through Technology

### Risk: "Technical scope underestimation ‚Üí product delays"

**Mitigation:**
- **Ruthless MVP scoping:** No features beyond what's listed here for V1
- **Weekly demos:** Ship working features every week (prevents scope creep)
- **Parallel development:** Backend, driver app, customer app can be built simultaneously once APIs are defined
- **Buffer time:** 3 months of buffer (Jun-Aug) before launch

### Risk: "Solo developer burnout"

**Mitigation:**
- **AI assistance:** Use Claude/GPT-4 for code generation (5-10x speed boost)
- **Component libraries:** shadcn/ui, Tailwind (no custom CSS from scratch)
- **Managed services:** Supabase, Vercel, Paystack (no infrastructure management)
- **Template reuse:** Driver app and customer app share 40% of code (auth, map, notifications)
- **Modular architecture:** Each feature is independent (can pause/resume without breaking others)

### Risk: "Android-only limits market"

**Accepted Trade-off:**
- 95%+ of Ghanaian smartphone market is Android
- Building iOS adds 40-50% more development time
- React Native would slow down V1 by 2-3 months
- Decision: Ship Android V1 fast, add iOS in Year 2 if demand exists

### Risk: "Payment integration complexity"

**Mitigation:**
- Paystack is designed for African markets (MTN MoMo, Vodafone Cash built-in)
- Well-documented SDK and API
- Fallback: Cash on delivery works for Month 1 if integration has issues
- But realistically, this is 3-4 days of work, not a major risk

### Risk: "Real-time features don't scale"

**Mitigation:**
- Supabase Realtime uses Postgres logical replication (proven technology)
- Scales to 10,000+ concurrent connections (we need 200 max for 154 trucks + customers)
- If scaling issues emerge in Year 2+, migrate to Redis Pub/Sub
- But for 28-month timeline, Supabase Realtime is more than sufficient

---

## Part 5: What We're Explicitly NOT Building for V1

### ‚ùå Not Building (Defer to V2/V3)

**iOS Apps:**
- Reason: 95% market is Android, Android-only builds are 40% faster
- Defer to: Month 13+ if demand exists

**Web Customer Ordering:**
- Reason: 99% of orders will come from mobile app
- Defer to: Month 18+ if commercial clients request it

**Complex Depot Platform:**
- Reason: Don't know requirements until January 2026 depot research complete
- Defer to: Month 13+ if depot owners need mobile app or operational suite (see Part 11)
- V1 approach: Simple web form or manual updates via phone/WhatsApp

**Dynamic Pricing / Surge Pricing:**
- Reason: Complex algorithm, not needed for first 6-12 months
- Defer to: Month 12+ when we have pricing data

**In-App Chat:**
- Reason: WhatsApp/phone calls work fine for V1
- Defer to: Month 18+ if support volume requires it

**Route Optimization:**
- Reason: Drivers know their routes better than algorithms initially
- Defer to: Month 12+ when we have enough data to build accurate models

**Multi-Language Support:**
- Reason: English is sufficient for Ghana launch
- Defer to: Month 24+ when expanding to francophone countries

**Automated Driver Payouts:**
- Reason: Manual batch processing is fine for 10-40 drivers
- Defer to: Month 18+ when processing 100+ drivers weekly

**Advanced Analytics (ML Models):**
- Reason: Not enough data in first 12 months
- Defer to: Month 18+ when we have predictive modeling opportunities

**IoT Depot Sensors:**
- Reason: Manual data collection works for V1 (5-8 depots)
- Defer to: Month 12+ when scaling to 14+ depots OR if depot research shows sensors are critical

**Multi-Tenancy:**
- Reason: Single city launch (Accra only)
- Defer to: Month 28+ when expanding to second city

---

## Part 6: Launch Day Technical Checklist

### September 1, 2026 - Required Technical State

**Apps:**
- ‚úÖ Driver app live on Google Play Store
- ‚úÖ Customer app live on Google Play Store
- ‚úÖ Admin dashboard accessible at admin.wateros.com
- ‚úÖ All apps on latest stable versions

**Backend:**
- ‚úÖ Production database live (Supabase)
- ‚úÖ All API endpoints functional
- ‚úÖ Real-time subscriptions working
- ‚úÖ Payment processing active (Paystack)
- ‚úÖ SMS notifications working
- ‚úÖ Email notifications working
- ‚úÖ Cron jobs scheduled

**Data:**
- ‚úÖ 50-100 verified locations in database (manual verification sprint in August)
- ‚úÖ 5-8 depots onboarded with full details
- ‚úÖ 10 drivers registered and approved
- ‚úÖ 5-10 commercial clients registered
- ‚úÖ Platform settings configured (pricing, commission rates, subsidy)

**Operations:**
- ‚úÖ Operations Manager trained on admin dashboard
- ‚úÖ Driver onboarding process documented
- ‚úÖ Customer support workflows defined
- ‚úÖ Emergency protocols established
- ‚úÖ Quality assurance partnership with SGS Ghana confirmed

**Monitoring:**
- ‚úÖ Error tracking (Sentry or similar)
- ‚úÖ Performance monitoring (Vercel Analytics)
- ‚úÖ Uptime monitoring (UptimeRobot)
- ‚úÖ Slack alerts for critical errors
- ‚úÖ Daily automated health check

**Legal:**
- ‚úÖ Privacy policy published
- ‚úÖ Terms of service published
- ‚úÖ Data protection compliance (DPA)
- ‚úÖ Payment processing agreements signed (Paystack)

---

## Part 7: Post-Launch Technical Roadmap (Months 1-6)

### October 2026 (Month 2):
- Fix critical bugs from first month
- Optimize slow queries based on real usage
- Add missing edge case handling

### November 2026 (Month 3):
- Subsidy program ends ‚Üí Remove subsidy logic from pricing
- Performance optimization based on real load
- Add any high-priority features requested by drivers/customers

### December 2026 (Month 4):
- First profitability milestone ‚Üí Celebrate üéâ
- Begin planning V2 features based on 3 months of usage data
- Analytics deep dive: What's working, what's not

### January-February 2027 (Months 5-6):
- Scale optimizations as driver count grows (10 ‚Üí 18)
- Add automation for repetitive admin tasks
- Prepare for next growth phase

---

## Part 8: Technology as Competitive Moat

### Why Speed Matters

**First-Mover Advantage:**
- No digital competitor exists in Accra water delivery market
- Launching September 2026 gives 6-12 month head start before copycats
- In that time, we build:
  - 154 drivers (7.7% market share)
  - 50-100 verified locations (proprietary data)
  - 5-8 depot partnerships (relationships take 9+ months)
  - Brand recognition and trust

**Technology as Barrier:**
- Competitors will say "we can build an app too"
- But they can't replicate:
  - 100+ verified GPS locations (18 months of ground truth data)
  - Depot relationships (9 months of trust-building)
  - Driver network effects (drivers bring customers)
  - Quality assurance partnerships (SGS Ghana contract)

**Execution Speed = Capital Efficiency:**
- Building in 6-7 months vs 18 months saves $100K+ in salary/runway
- Solo founder + AI = zero hiring friction
- Ship fast ‚Üí Learn fast ‚Üí Iterate fast

---

## Part 9: Final Build Timeline Summary

**Total Repositories: 2**

### Repository 1: `water-os-android`
**November 2025:** Foundation (Weeks 1-4)
- Set up Android Studio monorepo with 3 modules
- Configure Gradle modules: driver-app, customer-app, shared
- Design system and shared components

**December 2025 - February 2026:** Driver App + Shared Code (Weeks 5-18)
- Build shared module (auth, API client, models, Supabase, maps, payments)
- Build driver app screens and features
- Total: 14 weeks

**March 2026:** Customer App (Weeks 19-24)
- Reuse shared module (already built)
- Build customer-specific screens
- Total: 6 weeks (faster because shared code exists)

**April-May 2026:** Polish & Testing (Weeks 25-32)
- Bug fixes and refinements
- Performance optimization
- Beta testing with real users

### Repository 2: `water-os-platform`
**November 2025:** Foundation (Weeks 1-4)
- Set up Next.js project
- Configure Supabase
- Database schema design

**December 2025:** Backend Core (Weeks 5-10)
- API routes for mobile apps
- Order matching algorithm
- Payment integration (Paystack)
- Real-time subscriptions setup
- Total: 6 weeks

**April-May 2026:** Admin Dashboard (Weeks 25-32)
- Full operations command center
- Driver, order, customer, depot management
- Analytics and reporting
- Quality assurance workflow
- Total: 8 weeks

**May-June 2026:** Supporting Systems (Weeks 33-36)
- Location verification system
- Compliance tracking
- SMS/notifications refinements
- Optional: Simple depot status form (if research shows it's needed)
- Total: 4 weeks

### Both Repositories: Testing & Launch Prep
**July 2026:** Beta Testing (Weeks 37-42)
- Closed beta with 3-5 drivers
- Closed beta with 10-15 customers
- Fix critical bugs
- Operations manager training
- Total: 6 weeks

**August 2026:** Launch Prep (Weeks 43-45)
- Production deployment (Vercel)
- Google Play Store submission (both APKs)
- Final QA on production
- User documentation
- Dry run full order flow
- Total: 3 weeks

**September 1, 2026:** üöÄ LAUNCH

---

**Total Development Time:** 45 weeks (10.5 months)
**Actual Working Time:** 7 months focused development + 3 months testing/iteration

**Development Parallelization:**
- Weeks 1-10: Both repos (backend + Android foundation)
- Weeks 11-24: Android apps (backend APIs ready for integration)
- Weeks 25-32: Admin dashboard (Android apps feature-complete)
- Weeks 33-45: Integration testing and polish (both repos)

---

## Part 11: Depot Platform Decision Framework

### When Does Depot Functionality Need Its Own Repository?

**Default Assumption:** Depot functionality stays in `water-os-platform` (Repository 2) as simple web forms or admin dashboard features.

### Stays in `water-os-platform` if depot owners need:

‚úÖ **Simple status updates** (4-button form: Available/Low/Dry/Queue)
‚úÖ **Read-only dashboard** (performance metrics, transaction history)
‚úÖ **Compliance tracking** (view permits, upload documents, see test results)
‚úÖ **Basic reporting** (weekly volume reports for GWCL, download PDFs)
‚úÖ **Transaction history** (list of drivers who fetched water)

**Implementation:** Add `/app/(depot)/*` route group in existing Next.js platform
- Uses same Supabase database
- Uses same authentication system (add depot user role)
- Reuses admin dashboard components
- Deploys together with backend and admin
- **Build time:** 2-4 weeks

### Becomes 3rd Repository: `water-os-depot-app` if depot owners need:

#### Scenario A: Native Mobile App
‚ùó **Real-time mobile notifications** (push alerts when drivers on the way)
‚ùó **On-the-go status updates** (update from phone 20+ times per day)
‚ùó **Camera-based workflows** (scan driver IDs, photograph trucks, document water levels)
‚ùó **Offline functionality** (poor internet at depot, needs to queue updates)
‚ùó **GPS-based features** (verify driver actually at depot)

**Why separate:** Native mobile UX, reliable push notifications, camera integration, offline-first architecture
- **Build time:** 6-8 weeks for Android app
- **Technology:** Separate Android project (Kotlin)

#### Scenario B: Complex Operational Platform
‚ùó **IoT sensor integration** (automated water level monitoring)
‚ùó **Financial management suite** (accounting, invoicing, payroll for depot staff)
‚ùó **Multi-depot aggregation** (owner manages 5+ locations)
‚ùó **Dynamic pricing engine** (set prices by time of day, demand, driver tier)
‚ùó **Staff management** (scheduling, time tracking for 5-10 employees)
‚ùó **Advanced analytics** (profit margins, demand forecasting, BI dashboards)

**Why separate:** 15,000+ lines of depot-specific code justifies independent codebase
- **Build time:** 12-16 weeks for full operational platform
- **Technology:** Separate Next.js project or specialized framework

#### Scenario C: IoT Hardware Integration
‚ùó **Physical sensors** in depot tanks (ultrasonic, pressure sensors)
‚ùó **Queue cameras** with computer vision (count trucks automatically)
‚ùó **Automated gate systems** (driver QR check-in)
‚ùó **Real-time telemetry** (monitor tank levels, pump status, flow rates)

**Why separate:** Embedded systems, real-time streaming, edge computing
- **Build time:** 16-20 weeks + hardware procurement
- **Technology:** Python/Rust for embedded systems

### Decision Triggers

**Create 3rd repo if:**
1. Depot-specific code exceeds 15,000 lines
2. Different technology stack required (native mobile, embedded systems)
3. Independent deployment cadence needed (daily depot updates vs weekly platform updates)
4. Separate team ownership (hire depot operations specialists)
5. Depot becomes separate revenue stream (subscription product)

### Most Likely Path for Water OS

**Phase 1 (Months 1-12): Stay in Platform**
- Simple web form for status updates
- Read-only performance dashboard within admin
- GWCL compliance tools
- Transaction history
- **Why:** Depot research likely shows they want "better communication" not "complex software"

**Phase 2 (Months 13-24): Enhance Within Platform**
- Add features based on depot feedback
- Inventory tracking (manual entry)
- Basic analytics and reporting
- Still within `water-os-platform` repo

**Phase 3 (Months 25+): Potential Split**
- IF depot owners demand mobile app, operational suite, or IoT integration
- THEN create 3rd repo

### Research-Driven Decision

**January 2026 depot research will determine:**
- Do depots want mobile app or web is fine?
- Do they need complex operational tools or simple status updates?
- Are they willing to pay for sophisticated software?
- Do they have computers/tablets or just phones?

**Until research is complete, assume simple web forms in main platform.**

---

## Part 12: Final Architecture Summary

### The Complete Technical Stack

**2 Git Repositories. Clean. Simple. Maintainable.**

#### Repository 1: `water-os-android` (Mobile)
```
water-os-android/
‚îú‚îÄ‚îÄ driver-app/                # ‚Üí Driver.apk (Google Play)
‚îú‚îÄ‚îÄ customer-app/              # ‚Üí Customer.apk (Google Play)
‚îî‚îÄ‚îÄ shared/                    # ‚Üí Library (40-50% code reuse)
```
- **Technology:** Kotlin, Jetpack Compose, Supabase, Paystack, Google Maps
- **Build time:** 14 weeks (driver) + 6 weeks (customer) = 20 weeks total
- **Lines of code:** ~25,000-30,000

#### Repository 2: `water-os-platform` (Backend + Operations)
```
water-os-platform/
‚îú‚îÄ‚îÄ app/api/                   # ‚Üí Backend REST API
‚îú‚îÄ‚îÄ app/(admin)/               # ‚Üí Admin Dashboard
‚îú‚îÄ‚îÄ app/(depot)/               # ‚Üí Depot status form (optional)
‚îî‚îÄ‚îÄ lib/                       # ‚Üí Shared business logic
```
- **Technology:** Next.js, TypeScript, Supabase, Paystack, Google Maps
- **Build time:** 6 weeks (backend) + 8 weeks (admin) + 4 weeks (support) = 18 weeks total
- **Lines of code:** ~20,000-25,000
- **Deployment:** Vercel (one command: `git push`)

### Why This Architecture Wins

**vs. Traditional Approach (5+ repos):**
- ‚ùå Driver app repo
- ‚ùå Customer app repo
- ‚ùå Shared mobile library repo (published to Maven)
- ‚ùå Backend API repo (Express/NestJS)
- ‚ùå Admin dashboard repo (separate React app)
- ‚ùå Depot platform repo
- **Result:** Coordination nightmare, version hell, slow iteration

**Water OS Approach (2 repos):**
- ‚úÖ Mobile monorepo (driver + customer + shared)
- ‚úÖ Platform monorepo (backend + admin + depot)
- **Result:** Single source of truth, fast iteration, zero duplication

### Technology as Competitive Advantage

**Speed to Market:**
- 10-month build timeline (Nov 2025 ‚Üí Sep 2026)
- Competitors need 18-24 months to build equivalent system
- 6-12 month first-mover advantage

**What Competitors Can't Replicate:**
- 18 months of verified GPS location data
- 9 months of depot relationship building
- Driver network effects (drivers bring customers)
- GWCL regulatory positioning (if successful)
- SGS Ghana quality assurance partnership

**Maintainability:**
- 2 repos = easy for future hires to understand
- Monorepo structure = industry best practice
- Clear boundaries between mobile and backend
- Shared code eliminates duplication
- Type safety prevents drift

**Capital Efficiency:**
- Solo developer + AI = $0 engineering salaries
- Managed services (Supabase, Vercel) = $0 DevOps cost
- 2 repos vs 5+ = saved coordination overhead
- Launch in 10 months = saved 8-14 months of runway

### Post-Launch Evolution

**Month 1-12:**
- 2 repos remain unchanged
- Iterate on features within existing structure
- Add depot status form if research shows need (stays in platform repo)

**Month 13-28:**
- Still 2 repos (unless depot research reveals need for complex platform)
- Add advanced features (route optimization, analytics, automation)
- Scale within existing architecture (Next.js + Android handle 154 trucks easily)

**Month 29+:**
- Evaluate 3rd repo only if:
  - Depots need native mobile app
  - Depots need complex operational software (15,000+ lines)
  - IoT sensor deployment requires embedded systems
- Otherwise, stay with 2 repos

**The 2-repo architecture serves the business through Year 3+ before needing reevaluation.**

---

## Conclusion: This is Achievable

**Why this timeline is realistic:**

1. **Modern tooling eliminates 60% of traditional complexity:**
   - Supabase = No backend infrastructure
   - Vercel = No DevOps
   - Paystack = No payment system from scratch
   - Google Maps = No mapping from scratch

2. **AI-assisted development = 5-10x speed boost:**
   - Boilerplate code generation
   - Bug fixing assistance
   - Architecture decisions validated instantly
   - Component scaffolding

3. **Focused scope = No feature creep:**
   - Clear MVP definition
   - Deferred features documented (not forgotten)
   - Every feature serves the core business model

4. **Expert developer advantage:**
   - No learning curve on tools
   - Architectural decisions made quickly
   - No coordination overhead (solo)
   - Direct line from strategy ‚Üí code

5. **Buffer built in:**
   - 3 months of testing/iteration before launch
   - Can absorb 4-6 week delay without missing launch date
   - Quality over speed in final months

**The 10-month timeline from idea to launch is ambitious but achievable.** Most importantly, it's the right pace for this business:
- Fast enough to capture first-mover advantage
- Slow enough to build quality product
- Synchronized with 9-month depot relationship building
- Aligned with September 2026 launch goal

**Let's build this. üöÄ**
